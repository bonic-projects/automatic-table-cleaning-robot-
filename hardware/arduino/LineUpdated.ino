#include <NewPing.h>


 #define sTrig 51
  #define sEcho 53
#define fTrig 49
#define fEcho 47

int s1 = 0;
int s2 = 0;
int s3 = 0;
int s4 = 0;
int s5 = 0;
int s6 = 0;
int s7 = 0;
int s8 = 0;
int l1 = 0;
int l2 = 0;
int l3 = 0;
int l4 = 0;
int l5 = 0;
int l6 = 0;
int l7 = 0;
int l8 = 0;
int cleanNo = 0;

void motor_stop();
void forward();
void right();
void left();
void clean();
void rights();
void lefts();
void junction();
void leftSensor();
NewPing sonarS(sTrig, sEcho, 200); 
void setup() 
{
  Serial1.begin(115200);
  Serial.begin(115200);
  Serial2.begin(115200);
  // put your setup code here, to run once:
  pinMode(A0,INPUT);
  pinMode(A1,INPUT);
  pinMode(A2,INPUT);
  pinMode(A3,INPUT);
  pinMode(A4,INPUT);
  pinMode(A5,INPUT);
  pinMode(A6,INPUT);
  pinMode(A7,INPUT);
  pinMode(A8,INPUT);
  pinMode(A9,INPUT);
  pinMode(A10,INPUT);
  pinMode(A11,INPUT);
  pinMode(A12,INPUT);
  pinMode(A13,INPUT);
  pinMode(A14,INPUT);
  pinMode(A15,INPUT);
}

void loop() 
{
   int sdistance = sonarS.ping_cm();
   if (sdistance >40){
  // delay(1000);
  s1=digitalRead(A0);
  s2=digitalRead(A1);
  s3=digitalRead(A2);
  s4=digitalRead(A3);
  s5=digitalRead(A4);
  s6=digitalRead(A5);
  s7=digitalRead(A6);
  s8=digitalRead(A7);

 int sdistance = sonarS.ping_cm();
 

  // Serial.print(s1);
  
  // Serial.print(" ");
  // Serial.print(s2);
  // Serial.print(" ");
  // Serial.print(s3);
  // Serial.print(" ");
  // Serial.print(s4);
  // Serial.print(" ");
  // Serial.print(s5);
  // Serial.print(" ");
  // Serial.print(s6);
  // Serial.print(" ");
  // Serial.print(s7);
  // Serial.print(" ");
  // Serial.print(s8);
  // Serial.println(" ");
  // delay (1000);
  
  
  //black=1
  //white=0
  //forward
  if(
  ((s1==0)&&(s2==0)&&(s3==0)&&(s4==1)&&(s5==1)&&(s6==0)&&(s7==0)&&(s8==0))||
  ((s1==0)&&(s2==0)&&(s3==1)&&(s4==1)&&(s5==1)&&(s6==1)&&(s7==0)&&(s8==0))||
  ((s1==0)&&(s2==1)&&(s3==1)&&(s4==1)&&(s5==1)&&(s6==1)&&(s7==1)&&(s8==0))||
  ((s1==0)&&(s2==0)&&(s3==0)&&(s4==0)&&(s5==1)&&(s6==0)&&(s7==0)&&(s8==0))||
  ((s1==0)&&(s2==0)&&(s3==0)&&(s4==1)&&(s5==0)&&(s6==0)&&(s7==0)&&(s8==0))||
  ((s1==0)&&(s2==1)&&(s3==1)&&(s4==1)&&(s5==1)&&(s6==1)&&(s7==1)&&(s8==0))||
  ((s1==0)&&(s2==1)&&(s3==1)&&(s4==1)&&(s5==1)&&(s6==0)&&(s7==0)&&(s8==0))||
  ((s1==0)&&(s2==0)&&(s3==0)&&(s4==1)&&(s5==1)&&(s6==1)&&(s7==1)&&(s8==0))
  )
  {
    forward();
  }
  //right
  else if(
  ((s1==0)&&(s2==1)&&(s3==1)&&(s4==1)&&(s5==1)&&(s6==1)&&(s7==1)&&(s8==1))||
  ((s1==0)&&(s2==0)&&(s3==1)&&(s4==1)&&(s5==1)&&(s6==1)&&(s7==1)&&(s8==1))||
  ((s1==0)&&(s2==0)&&(s3==0)&&(s4==1)&&(s5==1)&&(s6==1)&&(s7==1)&&(s8==1))||
  ((s1==0)&&(s2==0)&&(s3==0)&&(s4==0)&&(s5==1)&&(s6==1)&&(s7==1)&&(s8==1))||
  ((s1==0)&&(s2==0)&&(s3==0)&&(s4==0)&&(s5==0)&&(s6==1)&&(s7==1)&&(s8==1))||
  ((s1==0)&&(s2==0)&&(s3==0)&&(s4==0)&&(s5==0)&&(s6==0)&&(s7==1)&&(s8==1))||
  ((s1==0)&&(s2==0)&&(s3==0)&&(s4==0)&&(s5==0)&&(s6==0)&&(s7==0)&&(s8==1))||
  ((s1==0)&&(s2==0)&&(s3==0)&&(s4==0)&&(s5==0)&&(s6==1)&&(s7==1)&&(s8==0))||
  ((s1==0)&&(s2==0)&&(s3==0)&&(s4==0)&&(s5==1)&&(s6==1)&&(s7==0)&&(s8==0))||
  ((s1==0)&&(s2==0)&&(s3==0)&&(s4==0)&&(s5==1)&&(s6==1)&&(s7==1)&&(s8==0))||
  ((s1==0)&&(s2==0)&&(s3==0)&&(s4==1)&&(s5==1)&&(s6==1)&&(s7==0)&&(s8==0))||
  ((s1==0)&&(s2==0)&&(s3==0)&&(s4==1)&&(s5==1)&&(s6==1)&&(s7==1)&&(s8==0))||
  ((s1==0)&&(s2==0)&&(s3==1)&&(s4==1)&&(s5==1)&&(s6==1)&&(s7==1)&&(s8==0))||
  ((s1==0)&&(s2==0)&&(s3==0)&&(s4==0)&&(s5==0)&&(s6==0)&&(s7==1)&&(s8==0))||
   ((s1==0)&&(s2==0)&&(s3==0)&&(s4==0)&&(s5==0)&&(s6==1)&&(s7==0)&&(s8==0))||
    (((s1==0)&&(s2==0)&&(s3==0)&&(s4==0)&&(s5==0))&&((s6==1)||(s7==1)||(s8==1)))
  )
  {
    right();
  }
  else if(
  ((s1==1)&&(s2==1)&&(s3==1)&&(s4==1)&&(s5==1)&&(s6==1)&&(s7==1)&&(s8==0))||
  ((s1==1)&&(s2==1)&&(s3==1)&&(s4==1)&&(s5==1)&&(s6==1)&&(s7==0)&&(s8==0))||
  ((s1==1)&&(s2==1)&&(s3==1)&&(s4==1)&&(s5==1)&&(s6==0)&&(s7==0)&&(s8==0))||
  ((s1==1)&&(s2==1)&&(s3==1)&&(s4==1)&&(s5==0)&&(s6==0)&&(s7==0)&&(s8==0))||
  ((s1==1)&&(s2==1)&&(s3==1)&&(s4==0)&&(s5==0)&&(s6==0)&&(s7==0)&&(s8==0))||
  ((s1==1)&&(s2==1)&&(s3==0)&&(s4==0)&&(s5==0)&&(s6==0)&&(s7==0)&&(s8==0))||
  ((s1==1)&&(s2==0)&&(s3==0)&&(s4==0)&&(s5==0)&&(s6==0)&&(s7==0)&&(s8==0))||
  ((s1==0)&&(s2==1)&&(s3==1)&&(s4==0)&&(s5==0)&&(s6==0)&&(s7==0)&&(s8==0))||
  ((s1==0)&&(s2==0)&&(s3==1)&&(s4==1)&&(s5==0)&&(s6==0)&&(s7==0)&&(s8==0))||
  ((s1==0)&&(s2==1)&&(s3==1)&&(s4==1)&&(s5==0)&&(s6==0)&&(s7==0)&&(s8==0))||
  ((s1==0)&&(s2==0)&&(s3==1)&&(s4==1)&&(s5==1)&&(s6==0)&&(s7==0)&&(s8==0))||
  ((s1==0)&&(s2==1)&&(s3==1)&&(s4==1)&&(s5==1)&&(s6==0)&&(s7==0)&&(s8==0))||
  ((s1==0)&&(s2==1)&&(s3==1)&&(s4==1)&&(s5==1)&&(s6==1)&&(s7==0)&&(s8==0))||
  (((s1==1)||(s2==1)||(s3==1))&&((s4==0)&&(s5==0)&&(s6==0)&&(s7==0)&&(s8==0)))
  )
  {
    left();
  }
  else if ((s1==1)&&(s2==1)&&(s3==1)&&(s4==1)&&(s5==1)&&(s6==1)&&(s7==1)&&(s8==1)){
    junction();
  } else motor_stop();

/*
0 = stop
1 = forward
2=right
3=left
4=clean
5= rights (leftside)
6= lefts (rightside)
*/
   }else{
    motor_stop();
   }
}
void motor_stop()
{
Serial1.write("0");
// Serial.println("stop");
}


void forward()
{
  // Serial.println("Forward");
  Serial1.write("1");
}

void right()
{
  // Serial.println("Right");
   Serial1.write("2");
}

void left()
{
  // Serial.println("Left");
  Serial1.write("3");
}
void clean(){
  Serial1.write("4");
}

void rights(){
  Serial1.write("5");
  // Serial.println("right-side");
}


void lefts(){
  Serial1.write("6");
  // Serial.println("Left-Side");
}



void junction(){
  // Serial.println("Junction detected!");
  forward();
  delay(2000);
  rights();
  delay(3500);
  motor_stop();
  delay(1000);
  leftSensor();
  // Serial.println("Left Sensor start work here");
}
void leftSensor(){
 l1=digitalRead(A8);
  l2=digitalRead(A9);
  l3=digitalRead(A10);
  l4=digitalRead(A11);
  l5=digitalRead(A12);
  l6=digitalRead(A13);
  l7=digitalRead(A14);
  l8=digitalRead(A15);
   if(
  ((l1==0)&&(l2==0)&&(l3==0)&&(l4==1)&&(l5==1)&&(l6==0)&&(l7==0)&&(l8==0))||
  ((l1==0)&&(l2==0)&&(l3==1)&&(l4==1)&&(l5==1)&&(l6==1)&&(l7==0)&&(l8==0))||
  ((l1==0)&&(l2==1)&&(l3==1)&&(l4==1)&&(l5==1)&&(l6==1)&&(l7==1)&&(l8==0))||
  ((l1==0)&&(l2==0)&&(l3==0)&&(l4==0)&&(l5==1)&&(l6==0)&&(l7==0)&&(l8==0))||
  ((l1==0)&&(l2==0)&&(l3==0)&&(l4==1)&&(l5==0)&&(l6==0)&&(l7==0)&&(l8==0))||
  ((l1==0)&&(l2==1)&&(l3==1)&&(l4==1)&&(l5==1)&&(l6==1)&&(l7==1)&&(l8==0))||
  ((l1==0)&&(l2==1)&&(l3==1)&&(l4==1)&&(l5==1)&&(l6==0)&&(l7==0)&&(l8==0))||
  ((l1==0)&&(l2==0)&&(l3==0)&&(l4==1)&&(l5==1)&&(l6==1)&&(l7==1)&&(l8==0))
  )
  {
    rights();
  }
  //right
  else if(
  ((l1==0)&&(l2==1)&&(l3==1)&&(l4==1)&&(l5==1)&&(l6==1)&&(l7==1)&&(l8==1))||
  ((l1==0)&&(l2==0)&&(l3==1)&&(l4==1)&&(l5==1)&&(l6==1)&&(l7==1)&&(l8==1))||
  ((l1==0)&&(l2==0)&&(l3==0)&&(l4==1)&&(l5==1)&&(l6==1)&&(l7==1)&&(l8==1))||
  ((l1==0)&&(l2==0)&&(l3==0)&&(l4==0)&&(l5==1)&&(l6==1)&&(l7==1)&&(l8==1))||
  ((l1==0)&&(l2==0)&&(l3==0)&&(l4==0)&&(l5==0)&&(l6==1)&&(l7==1)&&(l8==1))||
  ((l1==0)&&(l2==0)&&(l3==0)&&(l4==0)&&(l5==0)&&(l6==0)&&(l7==1)&&(l8==1))||
  ((l1==0)&&(l2==0)&&(l3==0)&&(l4==0)&&(l5==0)&&(l6==0)&&(l7==0)&&(l8==1))||
  ((l1==0)&&(l2==0)&&(l3==0)&&(l4==0)&&(l5==0)&&(l6==1)&&(l7==1)&&(l8==0))||
  ((l1==0)&&(l2==0)&&(l3==0)&&(l4==0)&&(l5==1)&&(l6==1)&&(l7==0)&&(l8==0))||
  ((l1==0)&&(l2==0)&&(l3==0)&&(l4==0)&&(l5==1)&&(l6==1)&&(l7==1)&&(l8==0))||
  ((l1==0)&&(l2==0)&&(l3==0)&&(l4==1)&&(l5==1)&&(l6==1)&&(l7==0)&&(l8==0))||
  ((l1==0)&&(l2==0)&&(l3==0)&&(l4==1)&&(l5==1)&&(l6==1)&&(l7==1)&&(l8==0))||
  ((l1==0)&&(l2==0)&&(l3==1)&&(l4==1)&&(l5==1)&&(l6==1)&&(l7==1)&&(l8==0))||
  ((l1==0)&&(l2==0)&&(l3==0)&&(l4==0)&&(l5==0)&&(l6==0)&&(l7==1)&&(l8==0))||
   ((l1==0)&&(l2==0)&&(l3==0)&&(l4==0)&&(l5==0)&&(l6==1)&&(l7==0)&&(l8==0))||
    (((l1==0)&&(l2==0)&&(l3==0)&&(l4==0)&&(l5==0))&&((l6==1)||(l7==1)||(l8==1)))
  )
  {
    right();
  }
  else if(
  ((l1==1)&&(l2==1)&&(l3==1)&&(l4==1)&&(l5==1)&&(l6==1)&&(l7==1)&&(l8==0))||
  ((l1==1)&&(l2==1)&&(l3==1)&&(l4==1)&&(l5==1)&&(l6==1)&&(l7==0)&&(l8==0))||
  ((l1==1)&&(l2==1)&&(l3==1)&&(l4==1)&&(l5==1)&&(l6==0)&&(l7==0)&&(l8==0))||
  ((l1==1)&&(l2==1)&&(l3==1)&&(l4==1)&&(l5==0)&&(l6==0)&&(l7==0)&&(l8==0))||
  ((l1==1)&&(l2==1)&&(l3==1)&&(l4==0)&&(l5==0)&&(l6==0)&&(l7==0)&&(l8==0))||
  ((l1==1)&&(l2==1)&&(l3==0)&&(l4==0)&&(l5==0)&&(l6==0)&&(l7==0)&&(l8==0))||
  ((l1==1)&&(l2==0)&&(l3==0)&&(l4==0)&&(l5==0)&&(l6==0)&&(l7==0)&&(l8==0))||
  ((l1==0)&&(l2==1)&&(l3==1)&&(l4==0)&&(l5==0)&&(l6==0)&&(l7==0)&&(l8==0))||
  ((l1==0)&&(l2==0)&&(l3==1)&&(l4==1)&&(l5==0)&&(l6==0)&&(l7==0)&&(l8==0))||
  ((l1==0)&&(l2==1)&&(l3==1)&&(l4==1)&&(l5==0)&&(l6==0)&&(l7==0)&&(l8==0))||
  ((l1==0)&&(l2==0)&&(l3==1)&&(l4==1)&&(l5==1)&&(l6==0)&&(l7==0)&&(l8==0))||
  ((l1==0)&&(l2==1)&&(l3==1)&&(l4==1)&&(l5==1)&&(l6==0)&&(l7==0)&&(l8==0))||
  ((l1==0)&&(l2==1)&&(l3==1)&&(l4==1)&&(l5==1)&&(l6==1)&&(l7==0)&&(l8==0))||
  (((l1==1)||(l2==1)||(l3==1))&&((l4==0)&&(l5==0)&&(l6==0)&&(l7==0)&&(l8==0)))
  )
  {
    left();
  }  else if ((l1==1)&&(l2==1)&&(l3==1)&&(l4==1)&&(l5==1)&&(l6==1)&&(l7==1)&&(l8==1)){
    clean();
     cleanNo = cleanNo + 1 ;
    // delay(1000);
    // if(cleanNo<2){
    // cleanNo = cleanNo + 1 ;
    // leftSensor();
    // }else{
    //
    //   jnNo = jnNo+1;
    // }
  } else motor_stop();
  if(cleanNo<1){
    leftSensor();
  }
}
